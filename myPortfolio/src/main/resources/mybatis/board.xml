<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- sql문이 모여있는 맵퍼 파일  mybatis-config.xml에서 설정한Book클래스를 이용해서 사용한다. -->

<mapper namespace="board"><!-- DaoImpl에서 사용된다 예)board.list -->
	
	<select id="total" resultType="Integer">
		SELECT COUNT(*) FROM board where B_DELETE = 'N'
	</select>
	
<!-- 	포트폴리오 리스트 삭제가 N인것만 가져온다. -->
<!-- 		페이지네이션을 위해 오라클 에서는 서브쿼리를 두번 날려줘야 한다.(rownum 사용) -->
<!-- 	CDATA 로 감싸서 <= 부호를 글자 그대로 인식하도록 해준다. -->
<!--    page는 현재 페이지를 의미    perPage는 페이지 당 보여줄 개수 (한번에 출력할 개수)
		select *
		from (select rownum row_num, sub.* 
		from (select b_no,b_title,b_writer,b_contents,b_date from board where b_delete='N' order by b_no) sub)
		where row_num > (현재 페이지 -1 * 한번에 보여질 갯수) and row_num <= (현재 페이지 * 한번에 보여질 갯수);
-->
	<select id="list" resultType="Board">
		select *
		from (select rownum row_num, sub.* 
		from (select b_no,b_title,b_writer,b_contents,b_date from board where b_delete='N' order by b_no) sub)
		<![CDATA[
		where row_num > ((#{page} - 1) * #{perPage}) and row_num <= (#{page} * #{perPage})
		]]>
	</select>
	
<!-- 	포트폴리오 등록 시퀀스를 이용해서 자동증가 1부터 1씩증가  -->
	<insert id="add">
		insert into board(b_no,b_title,b_writer,b_contents,b_date)
		values(bno_seq.nextval,#{bTitle},#{bWriter},#{bContents},sysdate)
	</insert>
	
<!-- 포트폴리오 조회수 증가 -->
	<update id="viewCount">
		update board
		set b_views = b_views +1
		where b_no = #{bNo}
	</update>
<!-- 	포트폴리오 상세보기 -->
	<select id="view" resultType="Board">
		select b_no,b_title,b_writer,b_contents,b_date,b_views from board where b_no = #{bNo}
	</select>
<!-- 	포트폴리오 수정 -->
	<update id="update">
		update board
		set b_title = #{bTitle},
		b_contents = #{bContents},
		b_update_date = sysdate,
		b_update_writer = #{bUpdateWriter}
		where b_no = #{bNo}
	</update>
<!-- 	포트폴리오 삭제 -->
	<update id="delete">
		update board
		set b_delete = 'Y',
		b_delete_date = sysdate,
		b_update_writer = #{bUpdateWriter}
		where b_no = #{bNo}
	</update>
</mapper>